<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"] - MusicPlataform</title>
    <link rel="stylesheet" href="~/css/site.css" />
</head>
<body>
    <header class="navbar">
        <div class="nav-left">
            <button class="nav-btn">🏠</button>
            <input type="text" placeholder="¿Qué quieres reproducir?" class="search">
        </div>
        <div class="nav-right">
            <a href="#">Premium</a>
            <a href="#">Ayuda</a>
            <a href="#">Descargar</a>

            @if (User.Identity != null && User.Identity.IsAuthenticated)
            {
                <a asp-controller="Users" asp-action="Logout">Cerrar sesión (@User.Identity.Name)</a>
            }
            else
            {
                <a asp-controller="Users" asp-action="Login">Iniciar sesión</a>
            }
        </div>
    </header>

    <div class="container">
        <div class="sidebar">
            <h2>Tu biblioteca</h2>

            @if (User.Identity != null && User.Identity.IsAuthenticated)
            {
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" asp-controller="ArTrack" asp-action="MiBiblioteca">🎵 Mi Biblioteca</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" asp-controller="Playlists" asp-action="UserLibrary" asp-route-username="@User.Identity.Name">
                            📂 Mis Playlists
                        </a>
                    </li>
                </ul>
            }
            else
            {
                <span>Inicia sesión para ver tu biblioteca</span>
            }
        </div>


        <div class="inicio">
            @RenderBody()
        </div>

        @* <div class="details" id="details">
            <h3>Detalles</h3>
            <p>Aquí aparecerá información de la canción seleccionada.</p>
        </div> *@
    </div>

    <footer id="audio-footer" style="display: none;">
        <div class="footer-content">
            <div class="footer-info">
                <img id="footer-img" src="" alt="" />
                <div>
                    <div id="footer-title">Título</div>
                    <div id="footer-artist">Artista</div>
                </div>
            </div>

            <div class="footer-controls">
                <button id="footer-play">&#10073;&#10073;</button>
                <span id="current-time">0:00</span>
                <input type="range" id="progress-bar" value="0" min="0" max="100" step="0.1">
                <span id="total-duration">0:00</span>
                <audio id="footer-audio"></audio>
            </div>
        </div>
    </footer>

    <script src="/js/site.js"></script>
    @RenderSection("Scripts", required: false)

    <script>
        // Función para añadir canciones a la biblioteca
        async function addToLibrary(trackId) {
            const username = "@User.Identity?.Name";

            if (!username) {
                alert("Debes iniciar sesión para usar la biblioteca.");
                return;
            }

            const response = await fetch(`/api/playlists/user/${username}/library/addtrack`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ trackId: trackId })
            });

            const data = await response.json();
            alert(data.message);
        }
    </script>
</body>
</html>
